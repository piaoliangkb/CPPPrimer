<!-- TOC -->

- [第四章 表达式](#第四章-表达式)
    - [4.1 基础](#41-基础)
        - [4.1.1 基本概念](#411-基本概念)
        - [4.1.2 优先级和结合律](#412-优先级和结合律)
        - [4.1.3 求值顺序](#413-求值顺序)
    - [4.2 算术运算符](#42-算术运算符)
        - [练习4.6 一个表达式判断一个数是奇数还是偶数](#练习46-一个表达式判断一个数是奇数还是偶数)
        - [练习4.7 三条导致溢出的语句](#练习47-三条导致溢出的语句)

<!-- /TOC -->

# 第四章 表达式

## 4.1 基础

### 4.1.1 基本概念

- 一元运算符：取地址符&，解引用符*
- 二元运算符：相等运算==，乘法运算*
- 三元运算符
- 函数调用也是一种特殊的运算符，运算对象数量没有限制

### 4.1.2 优先级和结合律

### 4.1.3 求值顺序

优先级规定运算对象的组合方式，但是没有规定求值顺序。大多数情况下不会指明求值顺序。

```cpp
int m = f1() * f2();
```

例如上述表达式我们就不知道是`f1()`先调用还是`f2()`。如果两个函数都修改同一个对象那么就会引发错误，产生未定义的行为。

例如：

```cpp
int i=0;
cout << i << " " << ++i << endl;
```

上述输出表达式是未定义的，不同编译器可能做出不同的操作。这种表达式的行为不可预知，所以是错误的。

有四种运算符明确规定了运算对象的求值顺序：

- 逻辑与`&&`，先求左边，左边为真才求右边
- 逻辑或`||`
- 条件运算符`?:`
- 逗号运算符`,`

处理复合表达式的两个建议：

- 拿不准的时候使用括号强制让表达式的组合关系符合程序的逻辑需求。

- 如果改变了某个运算对象的值，那么表达式的其他部分不要再使用这个对象。

`*++iter`先递增，再解引用

## 4.2 算术运算符

![](https://ws1.sinaimg.cn/large/7e197809ly1g34do3l4unj20yi0cvwgo.jpg)

算符优先级从上到下依次减小。左结合律表示：优先级相同时按照从左到右的顺序进行组合。

- 一元符号运算符对运算对象取负后，返回其提升后的副本

```cpp
int i = 1024;
int k = -i;   // k = -1024

bool b = true;
bool b2 = -b; // b2 = true
```

对大多数运算符来说，bool对象被转换为int类型；b为true，那么转换为1；b2则为-1，-1不为0，所以b2为true。

- C++11规定除法运算中，如果两个运算对象符号不相同则商为负，且规定商向0取整（直接切除小数部分）。

```cpp
int a1 = -9;
int b1 = 2;
cout << a1/b1 << endl;

int a2 = 9;
int b2 = -5;
cout << a2/b2 << endl;
```

上述结果分别为-4， -1.

- C++新标准中，要求`(-m)/n`和`m/(-n)`都等于`-(m/n)`

- `m%(-n)`相当于`m%n`，`(-m)%n`相当于`-(m%n)`

例子如下：

```
21 % 6 = 3
21 % 7 = 0
-21 % -8 = -5     // 相当于-21 % 8 -> - (21 % 8) = -5
21 % -5 = 1

21 / 6 = 3
21 / 7 = 3
-21 / -8 = 2      // 相当于 -21 / -8 -> 21 / 8 = 2
21 / -5 = -4      // 相当于 - (21 / 5) = -4
```

### 练习4.6 一个表达式判断一个数是奇数还是偶数

```
i % 2 == 0 ? "odd" : "even";
```

### 练习4.7 三条导致溢出的语句

```cpp
int main()
{
    short a = 32767; // short为16位，2^16 = 32768，正数部分为0~32767
    cout << ++a << endl;

    unsigned n = 0;
    cout << --n << endl;

    unsigned short m = 65535; // 2^16 = 65536
    cout << ++m << endl;
}

// output is：
// -32768
// 4294967295
// 0
```